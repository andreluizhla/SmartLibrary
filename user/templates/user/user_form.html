{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}{% if user.pk %}Editor{% else %}Cadastro{% endif %} de Usuário{% endblock title %}

{% block main_content %}
    <h1>{% if user.pk %}Editor{% else %}Cadastro{% endif %} de Usuário</h1>
    <form method="POST" id="userForm">
        {% csrf_token %}
        {{ form|crispy }} 
        <button class="btn btn-primary" type="submit">{% if user.pk %}<i class="bi bi-floppy2-fill"></i> Salvar{% else %}Enviar{% endif %}</button>
    </form>
    <script>
        function mostrarCamposUsuarios() {
            const type_user = document.getElementById("id_type_user").value;
            const cgmField = document.getElementById("div_id_cgm");
            const cgmInput = document.getElementById("id_cgm");
        
            if (type_user === '0') {
                cgmField.style.display = "block";
                cgmInput.required = true;
            } else {
                cgmField.style.display = "none";
                cgmInput.required = false;
                cgmInput.value = ""; // Limpa o valor quando escondido
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            mostrarCamposUsuarios();
        
            // Adiciona validação no submit
            document.getElementById('userForm').addEventListener('submit', function(e) {
                mostrarCamposUsuarios(); // Força validação antes de enviar
            });
        });
    </script>
{% endblock main_content %}